#!/usr/bin/env bash
# This script configures a new Ubuntu machine to include a custom HTTP response header

# Exit immediately if a command exits with a non-zero status
set -e

# Update package lists and install Nginx
sudo apt update -y
sudo apt install -y nginx

# Ensure Nginx is enabled and started
sudo systemctl enable nginx
sudo systemctl start nginx

# Get the hostname of the server
HOSTNAME=$(hostname)

# Configure Nginx to include the custom header
CONFIG_FILE="/etc/nginx/sites-available/default"
sudo sed -i '/server_name _;/a \tadd_header X-Served-By "$HOSTNAME";' "$CONFIG_FILE"

# Test Nginx configuration and reload if successful
sudo nginx -t && sudo systemctl reload nginx

# Print completion message
echo "Nginx configured with X-Served-By header on $HOSTNAME"
